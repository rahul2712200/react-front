{"ast":null,"code":"import _defineProperty from \"C:\\\\summer project\\\\react-front\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/defineProperty\";\nimport _classCallCheck from \"C:\\\\summer project\\\\react-front\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:\\\\summer project\\\\react-front\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"C:\\\\summer project\\\\react-front\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"C:\\\\summer project\\\\react-front\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"C:\\\\summer project\\\\react-front\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"C:\\\\summer project\\\\react-front\\\\src\\\\user\\\\EditProfile.js\";\nimport React, { Component } from \"react\";\nimport { isAuthenticated } from \"../auth\";\nimport { read, update, updateUser } from \"./apiUser\";\nimport { Redirect } from \"react-router-dom\";\nimport DefaultProfile from \"../images/avatar.jpg\";\n\nvar EditProfile =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(EditProfile, _Component);\n\n  function EditProfile() {\n    var _this;\n\n    _classCallCheck(this, EditProfile);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(EditProfile).call(this));\n\n    _this.init = function (userId) {\n      var token = isAuthenticated().token;\n      read(userId, token).then(function (data) {\n        if (data.error) {\n          _this.setState({\n            redirectToProfile: true\n          });\n        } else {\n          _this.setState({\n            id: data._id,\n            name: data.name,\n            email: data.email,\n            error: \"\",\n            about: data.about\n          });\n        }\n      });\n    };\n\n    _this.isValid = function () {\n      var _this$state = _this.state,\n          name = _this$state.name,\n          email = _this$state.email,\n          password = _this$state.password,\n          fileSize = _this$state.fileSize;\n\n      if (fileSize > 1000000) {\n        _this.setState({\n          error: \"File size should be less than 100kb\",\n          loading: false\n        });\n\n        return false;\n      }\n\n      if (name.length === 0) {\n        _this.setState({\n          error: \"Name is required\",\n          loading: false\n        });\n\n        return false;\n      } // email@domain.com\n\n\n      if (!/^\\w+([\\.-]?\\w+)*@\\w+([\\.-]?\\w+)*(\\.\\w{2,3})+$/.test(email)) {\n        _this.setState({\n          error: \"A valid Email is required\",\n          loading: false\n        });\n\n        return false;\n      }\n\n      if (password.length >= 1 && password.length <= 5) {\n        _this.setState({\n          error: \"Password must be at least 6 characters long\",\n          loading: false\n        });\n\n        return false;\n      }\n\n      return true;\n    };\n\n    _this.handleChange = function (name) {\n      return function (event) {\n        var _this$setState;\n\n        _this.setState({\n          error: \"\"\n        });\n\n        var value = name === \"photo\" ? event.target.files[0] : event.target.value;\n        var fileSize = name === \"photo\" ? event.target.files[0].size : 0;\n\n        _this.userData.set(name, value);\n\n        _this.setState((_this$setState = {}, _defineProperty(_this$setState, name, value), _defineProperty(_this$setState, \"fileSize\", fileSize), _this$setState));\n      };\n    };\n\n    _this.clickSubmit = function (event) {\n      event.preventDefault();\n\n      _this.setState({\n        loading: true\n      });\n\n      if (_this.isValid()) {\n        var userId = _this.props.match.params.userId;\n        var token = isAuthenticated().token;\n        update(userId, token, _this.userData).then(function (data) {\n          if (data.error) {\n            _this.setState({\n              error: data.error\n            });\n          } else if (isAuthenticated().user.role === \"admin\") {\n            _this.setState({\n              redirectToProfile: true\n            });\n          } else {\n            updateUser(data, function () {\n              _this.setState({\n                redirectToProfile: true\n              });\n            });\n          }\n        });\n      }\n    };\n\n    _this.signupForm = function (name, email, password, about) {\n      return React.createElement(\"form\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 113\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"form-group\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 114\n        },\n        __self: this\n      }, React.createElement(\"label\", {\n        className: \"text-muted\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 115\n        },\n        __self: this\n      }, \"Profile Photo\"), React.createElement(\"input\", {\n        onChange: _this.handleChange(\"photo\"),\n        type: \"file\",\n        accept: \"image/*\",\n        className: \"form-control\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 116\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        className: \"form-group\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 123\n        },\n        __self: this\n      }, React.createElement(\"label\", {\n        className: \"text-muted\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 124\n        },\n        __self: this\n      }, \"Name\"), React.createElement(\"input\", {\n        onChange: _this.handleChange(\"name\"),\n        type: \"text\",\n        className: \"form-control\",\n        value: name,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 125\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        className: \"form-group\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 132\n        },\n        __self: this\n      }, React.createElement(\"label\", {\n        className: \"text-muted\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 133\n        },\n        __self: this\n      }, \"Email\"), React.createElement(\"input\", {\n        onChange: _this.handleChange(\"email\"),\n        type: \"email\",\n        className: \"form-control\",\n        value: email,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 134\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        className: \"form-group\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 142\n        },\n        __self: this\n      }, React.createElement(\"label\", {\n        className: \"text-muted\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 143\n        },\n        __self: this\n      }, \"About\"), React.createElement(\"textarea\", {\n        onChange: _this.handleChange(\"about\"),\n        type: \"text\",\n        className: \"form-control\",\n        value: about,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 144\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        className: \"form-group\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 152\n        },\n        __self: this\n      }, React.createElement(\"label\", {\n        className: \"text-muted\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 153\n        },\n        __self: this\n      }, \"Password\"), React.createElement(\"input\", {\n        onChange: _this.handleChange(\"password\"),\n        type: \"password\",\n        className: \"form-control\",\n        value: password,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 154\n        },\n        __self: this\n      })), React.createElement(\"button\", {\n        onClick: _this.clickSubmit,\n        className: \"btn btn-raised btn-primary\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 161\n        },\n        __self: this\n      }, \"Update\"));\n    };\n\n    _this.state = {\n      id: \"\",\n      name: \"\",\n      email: \"\",\n      password: \"\",\n      redirectToProfile: false,\n      error: \"\",\n      fileSize: 0,\n      loading: false,\n      about: \"\"\n    };\n    return _this;\n  }\n\n  _createClass(EditProfile, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.userData = new FormData();\n      var userId = this.props.match.params.userId;\n      this.init(userId);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$state2 = this.state,\n          id = _this$state2.id,\n          name = _this$state2.name,\n          email = _this$state2.email,\n          password = _this$state2.password,\n          redirectToProfile = _this$state2.redirectToProfile,\n          error = _this$state2.error,\n          loading = _this$state2.loading,\n          about = _this$state2.about;\n\n      if (redirectToProfile) {\n        return React.createElement(Redirect, {\n          to: \"/user/\".concat(id),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 180\n          },\n          __self: this\n        });\n      }\n\n      var photoUrl = id ? \"\".concat(process.env.REACT_APP_API_URL, \"/user/photo/\").concat(id, \"?\").concat(new Date().getTime()) : DefaultProfile;\n      return React.createElement(\"div\", {\n        className: \"container\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 190\n        },\n        __self: this\n      }, React.createElement(\"h2\", {\n        className: \"mt-5 mb-5\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 191\n        },\n        __self: this\n      }, \"Edit Profile\"), React.createElement(\"div\", {\n        className: \"alert alert-danger\",\n        style: {\n          display: error ? \"\" : \"none\"\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 192\n        },\n        __self: this\n      }, error), loading ? React.createElement(\"div\", {\n        className: \"jumbotron text-center\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 200\n        },\n        __self: this\n      }, React.createElement(\"h2\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 201\n        },\n        __self: this\n      }, \"Loading...\")) : \"\", React.createElement(\"img\", {\n        style: {\n          height: \"200px\",\n          width: \"auto\"\n        },\n        className: \"img-thumbnail\",\n        src: photoUrl,\n        onError: function onError(i) {\n          return i.target.src = \"\".concat(DefaultProfile);\n        },\n        alt: name,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 207\n        },\n        __self: this\n      }), isAuthenticated().user.role === \"admin\" && this.signupForm(name, email, password, about), isAuthenticated().user._id === id && this.signupForm(name, email, password, about));\n    }\n  }]);\n\n  return EditProfile;\n}(Component);\n\nexport default EditProfile;","map":{"version":3,"sources":["C:\\summer project\\react-front\\src\\user\\EditProfile.js"],"names":["React","Component","isAuthenticated","read","update","updateUser","Redirect","DefaultProfile","EditProfile","init","userId","token","then","data","error","setState","redirectToProfile","id","_id","name","email","about","isValid","state","password","fileSize","loading","length","test","handleChange","event","value","target","files","size","userData","set","clickSubmit","preventDefault","props","match","params","user","role","signupForm","FormData","photoUrl","process","env","REACT_APP_API_URL","Date","getTime","display","height","width","i","src"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\r\nimport { isAuthenticated } from \"../auth\";\r\nimport { read, update, updateUser } from \"./apiUser\";\r\nimport { Redirect } from \"react-router-dom\";\r\nimport DefaultProfile from \"../images/avatar.jpg\";\r\n\r\nclass EditProfile extends Component {\r\n  constructor() {\r\n    super();\r\n    this.state = {\r\n      id: \"\",\r\n      name: \"\",\r\n      email: \"\",\r\n      password: \"\",\r\n      redirectToProfile: false,\r\n      error: \"\",\r\n      fileSize: 0,\r\n      loading: false,\r\n      about: \"\"\r\n    };\r\n  }\r\n\r\n  init = userId => {\r\n    const token = isAuthenticated().token;\r\n    read(userId, token).then(data => {\r\n      if (data.error) {\r\n        this.setState({ redirectToProfile: true });\r\n      } else {\r\n        this.setState({\r\n          id: data._id,\r\n          name: data.name,\r\n          email: data.email,\r\n          error: \"\",\r\n          about: data.about\r\n        });\r\n      }\r\n    });\r\n  };\r\n\r\n  componentDidMount() {\r\n    this.userData = new FormData();\r\n    const userId = this.props.match.params.userId;\r\n    this.init(userId);\r\n  }\r\n\r\n  isValid = () => {\r\n    const { name, email, password, fileSize } = this.state;\r\n    if (fileSize > 1000000) {\r\n      this.setState({\r\n        error: \"File size should be less than 100kb\",\r\n        loading: false\r\n      });\r\n      return false;\r\n    }\r\n    if (name.length === 0) {\r\n      this.setState({ error: \"Name is required\", loading: false });\r\n      return false;\r\n    }\r\n    // email@domain.com\r\n    if (!/^\\w+([\\.-]?\\w+)*@\\w+([\\.-]?\\w+)*(\\.\\w{2,3})+$/.test(email)) {\r\n      this.setState({\r\n        error: \"A valid Email is required\",\r\n        loading: false\r\n      });\r\n      return false;\r\n    }\r\n    if (password.length >= 1 && password.length <= 5) {\r\n      this.setState({\r\n        error: \"Password must be at least 6 characters long\",\r\n        loading: false\r\n      });\r\n      return false;\r\n    }\r\n    return true;\r\n  };\r\n\r\n  handleChange = name => event => {\r\n    this.setState({ error: \"\" });\r\n    const value = name === \"photo\" ? event.target.files[0] : event.target.value;\r\n\r\n    const fileSize = name === \"photo\" ? event.target.files[0].size : 0;\r\n    this.userData.set(name, value);\r\n    this.setState({ [name]: value, fileSize });\r\n  };\r\n\r\n  clickSubmit = event => {\r\n    event.preventDefault();\r\n    this.setState({ loading: true });\r\n\r\n    if (this.isValid()) {\r\n      const userId = this.props.match.params.userId;\r\n      const token = isAuthenticated().token;\r\n\r\n      update(userId, token, this.userData).then(data => {\r\n        if (data.error) {\r\n          this.setState({ error: data.error });\r\n        } else if (isAuthenticated().user.role === \"admin\") {\r\n          this.setState({\r\n            redirectToProfile: true\r\n          });\r\n        } else {\r\n          updateUser(data, () => {\r\n            this.setState({\r\n              redirectToProfile: true\r\n            });\r\n          });\r\n        }\r\n      });\r\n    }\r\n  };\r\n\r\n  signupForm = (name, email, password, about) => (\r\n    <form>\r\n      <div className=\"form-group\">\r\n        <label className=\"text-muted\">Profile Photo</label>\r\n        <input\r\n          onChange={this.handleChange(\"photo\")}\r\n          type=\"file\"\r\n          accept=\"image/*\"\r\n          className=\"form-control\"\r\n        />\r\n      </div>\r\n      <div className=\"form-group\">\r\n        <label className=\"text-muted\">Name</label>\r\n        <input\r\n          onChange={this.handleChange(\"name\")}\r\n          type=\"text\"\r\n          className=\"form-control\"\r\n          value={name}\r\n        />\r\n      </div>\r\n      <div className=\"form-group\">\r\n        <label className=\"text-muted\">Email</label>\r\n        <input\r\n          onChange={this.handleChange(\"email\")}\r\n          type=\"email\"\r\n          className=\"form-control\"\r\n          value={email}\r\n        />\r\n      </div>\r\n\r\n      <div className=\"form-group\">\r\n        <label className=\"text-muted\">About</label>\r\n        <textarea\r\n          onChange={this.handleChange(\"about\")}\r\n          type=\"text\"\r\n          className=\"form-control\"\r\n          value={about}\r\n        />\r\n      </div>\r\n\r\n      <div className=\"form-group\">\r\n        <label className=\"text-muted\">Password</label>\r\n        <input\r\n          onChange={this.handleChange(\"password\")}\r\n          type=\"password\"\r\n          className=\"form-control\"\r\n          value={password}\r\n        />\r\n      </div>\r\n      <button onClick={this.clickSubmit} className=\"btn btn-raised btn-primary\">\r\n        Update\r\n      </button>\r\n    </form>\r\n  );\r\n\r\n  render() {\r\n    const {\r\n      id,\r\n      name,\r\n      email,\r\n      password,\r\n      redirectToProfile,\r\n      error,\r\n      loading,\r\n      about\r\n    } = this.state;\r\n\r\n    if (redirectToProfile) {\r\n      return <Redirect to={`/user/${id}`} />;\r\n    }\r\n\r\n    const photoUrl = id\r\n      ? `${\r\n          process.env.REACT_APP_API_URL\r\n        }/user/photo/${id}?${new Date().getTime()}`\r\n      : DefaultProfile;\r\n\r\n    return (\r\n      <div className=\"container\">\r\n        <h2 className=\"mt-5 mb-5\">Edit Profile</h2>\r\n        <div\r\n          className=\"alert alert-danger\"\r\n          style={{ display: error ? \"\" : \"none\" }}\r\n        >\r\n          {error}\r\n        </div>\r\n\r\n        {loading ? (\r\n          <div className=\"jumbotron text-center\">\r\n            <h2>Loading...</h2>\r\n          </div>\r\n        ) : (\r\n          \"\"\r\n        )}\r\n\r\n        <img\r\n          style={{ height: \"200px\", width: \"auto\" }}\r\n          className=\"img-thumbnail\"\r\n          src={photoUrl}\r\n          onError={i => (i.target.src = `${DefaultProfile}`)}\r\n          alt={name}\r\n        />\r\n\r\n        {isAuthenticated().user.role === \"admin\" &&\r\n          this.signupForm(name, email, password, about)}\r\n\r\n        {isAuthenticated().user._id === id &&\r\n          this.signupForm(name, email, password, about)}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default EditProfile;\r\n"]},"metadata":{},"sourceType":"module"}